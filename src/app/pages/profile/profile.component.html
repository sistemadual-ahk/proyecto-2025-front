<div class="container" [class.editing]="isEditing">
  <!-- Main Content -->
  <div class="main">
    <!-- Navigation and Title -->
    <app-page-title title="Perfil" (back)="goBack()"></app-page-title>

    <!-- Profile Information -->
    <div class="profile-info" *ngIf="auth.user$ | async as user">
      <!-- Foto de perfil -->
      <div class="profile-picture-container">
        <div
          class="profile-picture"
          [style.background-image]="user.picture ? 'url(' + user.picture + ')' : 'none'"
        >
          <div class="profile-picture-placeholder" *ngIf="!user.picture">
            <i class="mdi mdi-account"></i>
          </div>
        </div>
      </div>

      <!-- Nombre y email -->
      <h1 class="user-name">{{ user.name }}</h1>
      <p class="user-email">{{ user.email }}</p>

      <!-- Botón editar perfil -->
      <button class="edit-profile-btn" (click)="editProfile()" *ngIf="!isEditing">
        Editar perfil
      </button>
    </div>

    <!-- User Details -->
    <div class="user-details">
      <div class="detail-card">
        <span class="detail-label">Ingreso mensual</span>
        <span class="detail-value" *ngIf="!isEditing">${{ usuario.ingresoMensual | number }}</span>
        <input
          type="number"
          class="detail-input"
          [(ngModel)]="usuario.ingresoMensual"
          *ngIf="isEditing"
        />
      </div>

      <div class="detail-card">
        <span class="detail-label">Situación laboral</span>
        <span class="detail-value" *ngIf="!isEditing">{{ usuario.situacionLaboral }}</span>
        <mat-select class="detail-select" [(ngModel)]="usuario.situacionLaboral" *ngIf="isEditing">
          <mat-option *ngFor="let situacion of situacionLaboralOptions" [value]="situacion">
            {{ situacion }}
          </mat-option>
        </mat-select>
      </div>

      <div class="detail-card">
        <span class="detail-label">Estado Civil</span>
        <span class="detail-value" *ngIf="!isEditing">{{ usuario.estadoCivil }}</span>
        <mat-select class="detail-select" [(ngModel)]="usuario.estadoCivil" *ngIf="isEditing">
          <mat-option *ngFor="let estado of estadoCivilOptions" [value]="estado">
            {{ estado }}
          </mat-option>
        </mat-select>
      </div>

      <div class="detail-card">
        <span class="detail-label">Profesión</span>
        <span class="detail-value" *ngIf="!isEditing">{{ usuario.profesion }}</span>
        <mat-select class="detail-select" [(ngModel)]="usuario.profesion" *ngIf="isEditing">
          <mat-option *ngFor="let pr of profesionOptions" [value]="pr">{{ pr }}</mat-option>
        </mat-select>
      </div>
      
      <div class="detail-card">
        <span class="detail-label">Provincia</span>
        <span class="detail-value" *ngIf="!isEditing">{{ usuario.provincia }}</span>
        <mat-select class="detail-select" [(ngModel)]="usuario.provincia" (ngModelChange)="onProvinciaChange($event)" *ngIf="isEditing">
          <mat-option *ngFor="let p of provincias" [value]="p.nombre">{{ p.nombre }}</mat-option>
        </mat-select>
      </div>
      
      <div class="detail-card">
        <span class="detail-label">Municipio</span>
        <span class="detail-value" *ngIf="!isEditing">{{ usuario.municipio }}</span>
        <mat-select class="detail-select" [(ngModel)]="usuario.municipio" (ngModelChange)="onMunicipioChange($event)" *ngIf="isEditing">
          <mat-option *ngFor="let m of municipios" [value]="m.nombre">{{ m.nombre }}</mat-option>
        </mat-select>
      </div>
      
      <div class="detail-card">
        <span class="detail-label">Localidad</span>
        <span class="detail-value" *ngIf="!isEditing">{{ usuario.localidad }}</span>
        <mat-select class="detail-select" [(ngModel)]="usuario.localidad" *ngIf="isEditing">
          <mat-option *ngFor="let l of localidades" [value]="l.nombre">{{ l.nombre }}</mat-option>
        </mat-select>
      </div>
    </div>

    <div class="detail-card">
        <span class="detail-label">Telegram ID</span>
        <span class="detail-value" *ngIf="!isEditing">{{ usuario.telegramID | number }}</span>
        <input
          type="number"
          class="detail-input"
          [(ngModel)]="usuario.telegramID"
          *ngIf="isEditing"
        />
      </div>

    <!-- Action Buttons -->
    <div class="action-buttons" *ngIf="isEditing">
      <button class="discard-btn" (click)="discardChanges()">Descartar cambios</button>
      <button class="save-btn" (click)="saveChanges()">Guardar cambios</button>
    </div>
  </div>
</div>
