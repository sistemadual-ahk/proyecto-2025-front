<div class="saving-goals-container">
  <!-- Navegación y título -->
  <app-page-title title="Objetivos de ahorro" (back)="goBack()"></app-page-title>

  <!-- Sección de objetivos de ahorro -->
  <div class="goals-section">
    <div class="goal-card" *ngFor="let goal of savingGoals" [class.completed]="isCompleted(goal)">
      <div class="goal-card-header">
        <div class="goal-header-left">
          <div class="category-icon-small" *ngIf="getCategory(goal.categoriaId) as cat" [style.background-color]="cat.color" [title]="cat.nombre">
            <i class="mdi" [ngClass]="cat.icono" [style.color]="cat.iconColor || '#fff'"></i>
          </div>
          <h3 class="goal-title">{{ goal.titulo }}</h3>
          <span class="goal-status-badge" [class.completed]="isCompleted(goal)">
            {{ isCompleted(goal) ? 'Completado' : 'Pendiente' }}
          </span>
        </div>
        <div class="goal-actions">
          <button class="goal-action-btn ops-btn" (click)="openGoalOperations(goal.id!); $event.stopPropagation()" aria-label="Agregar ingresos y gastos">
            <i class="mdi mdi-cash-plus"></i>
          </button>
          <button class="goal-action-btn edit-btn" (click)="editGoal(goal.id!); $event.stopPropagation()" aria-label="Editar objetivo">
            <i class="mdi mdi-pencil"></i>
          </button>
        </div>
      </div>
      <div class="progress-container">
        <div class="progress-header">
          <div class="goal-amounts">
            <span class="current-amount">${{ goal.montoActual.toLocaleString() }}</span>
            <span class="separator">/</span>
            <span class="target-amount">${{ goal.montoObjetivo.toLocaleString() }}</span>
          </div>
          <span class="progress-percentage">{{ getProgress(goal).toFixed(0) }}%</span>
        </div>
        <div class="progress-bar">
          <div
            class="progress-fill"
            [style.width.%]="getProgress(goal)"
            [style.background-color]="getCategory(goal.categoriaId)?.color || goal.color"
          ></div>
        </div>
      </div>

    </div>
    <!-- Botón de nuevo objetivo debajo de los objetivos -->
    <div class="new-goal-inline">
      <button class="new-goal-btn" (click)="addNewGoal()">
        <i class="mdi mdi-plus"></i>
        <span>Nuevo Objetivo</span>
      </button>
    </div>
  </div>


  <app-add-goal-modal 
    *ngIf="showAddGoal" 
    [edit]="isEditMode" 
    [objetivo]="selectedGoal"
    (close)="onCloseAddGoal()" 
    (save)="onSaveGoal($event)" 
    (delete)="onDeleteGoal()">
  </app-add-goal-modal>

  <app-goal-operations-modal
    *ngIf="showGoalOperations"
    [objetivo]="selectedGoalForOps"
    (close)="onCloseGoalOperations()"
    (save)="onSaveGoalOperations($event)">
  </app-goal-operations-modal>
</div>
