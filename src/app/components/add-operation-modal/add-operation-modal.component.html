<!-- Header del bottom sheet -->
<div class="bottom-sheet-header">
  <button class="close-btn" (click)="onClose()">
    <i class="mdi mdi-close"></i>
  </button>

  <h2 class="bottom-sheet-title">Agregar Operacion</h2>

  <button
    class="save-btn"
    type="button"
    (click)="onSave()"
    [disabled]="!isFormValid"
    [class.enabled]="isFormValid"
  >
    <i class="mdi mdi-check"></i>
  </button>
</div>

<!-- Toggle Ingreso/Gasto -->
<div class="transaction-toggle">
  <button
    class="toggle-btn income-btn"
    [class.active]="transactionType === 'income'"
    (click)="toggleTransactionType('income')"
  >
    <i class="mdi mdi-arrow-up-bold"></i> Ingreso
  </button>
  <button
    class="toggle-btn expense-btn"
    [class.active]="transactionType === 'expense'"
    (click)="toggleTransactionType('expense')"
  >
    <i class="mdi mdi-arrow-down-bold"></i> Gasto
  </button>
</div>

<!-- Formulario -->
<div class="transaction-form">
  <!-- Campo de monto -->
  <div class="form-group amount-group">
    <input
      type="number"
      inputmode="numeric"
      class="amount-input"
      [(ngModel)]="amount"
      placeholder="0"
      min="0"
    />
    <button class="clear-amount" (click)="amount = null">
      <i class="mdi mdi-close"></i>
    </button>
  </div>

  <!-- Campo de descripción -->
  <div class="form-group">
    <label class="form-label">Descripción</label>
    <input
      type="text"
      class="form-input"
      [(ngModel)]="description"
      [placeholder]="descriptionPlaceholder"
    />
  </div>

  <!-- Fecha y Billetera -->
  <div class="form-group">
    <label class="form-label">Fecha</label>
    <div class="input-with-icon date-input-wrapper">
      <input
        type="date"
        class="form-input date-input"
        [(ngModel)]="date"
      />
      <i class="mdi mdi-calendar"></i>
    </div>
  </div>

  <div class="form-group">
    <label class="form-label">Billetera</label>
    <div class="input-with-icon">
      <mat-select
        class="form-input"
        [(ngModel)]="wallet"
        name="wallet"
        placeholder="Sin asignar"
      >
        <mat-select-trigger>
          <div class="category-option-row" *ngIf="wallet">
            <div class="wallet-icon-preview" [style.background]="wallet.color || '#4caf50'">
              <i [class]="wallet.icon || 'mdi mdi-wallet'"></i>
            </div>
            <span class="category-name">{{ wallet.nombre }}</span>
          </div>
          <span *ngIf="!wallet">Sin asignar</span>
        </mat-select-trigger>
        <mat-option value="">Sin asignar</mat-option>
        <mat-option *ngFor="let walletOption of billeteras" [value]="walletOption">
          <div class="category-option-row">
            <div class="wallet-icon-preview" [style.background]="walletOption.color || '#4caf50'">
              <i [class]="walletOption.icon || 'mdi mdi-wallet'"></i>
            </div>
            <span class="category-name">{{ walletOption.nombre }}</span>
          </div>
        </mat-option>
      </mat-select>
      <i class="mdi mdi-wallet"></i>
    </div>
    <small class="form-hint" style="color: rgba(255, 255, 255, 0.5); margin-top: 4px; display: block; font-size: 11px;">
      Si no seleccionas, se asignará automáticamente
    </small>
  </div>

  <!-- Categoría -->
  <div class="form-group">
    <label class="form-label">Categoría</label>
    <div class="input-with-icon">
      <mat-select
        class="form-input"
        [(ngModel)]="category"
        name="category"
        placeholder="Seleccionar categoría"
      >
        <mat-select-trigger>
          <div class="category-option-row" *ngIf="category">
            <div class="category-icon-preview" [style.background-color]="category.color">
              <i class="mdi" [ngClass]="category.icono" [style.color]="category.iconColor || '#fff'"></i>
            </div>
            <span class="category-name">{{ category.nombre }}</span>
          </div>
        </mat-select-trigger>
        <mat-option value="">Seleccionar categoría</mat-option>
        <mat-option *ngFor="let categoryOption of categorias" [value]="categoryOption">
          <div class="category-option-row">
            <div class="category-icon-preview" [style.background-color]="categoryOption.color">
              <i class="mdi" [ngClass]="categoryOption.icono" [style.color]="categoryOption.iconColor || '#fff'"></i>
            </div>
            <span class="category-name">{{ categoryOption.nombre }}</span>
          </div>
        </mat-option>
      </mat-select>
      <i class="mdi mdi-tag"></i>
    </div>
    <small class="form-hint" *ngIf="!isLoading && categorias.length === 0" style="color: #ff6b6b; margin-top: 4px; display: block;">
      ⚠️ No hay categorías disponibles. Ve a Categorías y crea una primero.
    </small>
  </div>
</div>
