<div class="modal-content-wrapper">
<!-- Header del bottom sheet -->
<div class="bottom-sheet-header">
  <button class="close-btn" (click)="onClose()">
    <i class="mdi mdi-close"></i>
  </button>

  <h2 class="bottom-sheet-title">
    <i class="mdi mdi-target"></i>
    {{ edit ? 'Editar Objetivo' : 'Nuevo Objetivo' }}
  </h2>

  <button
    class="save-btn"
    type="button"
    (click)="onSave()"
    [disabled]="!isFormValid"
    [class.enabled]="isFormValid"
  >
    <i class="mdi mdi-check"></i>
  </button>
</div>

<!-- Formulario -->
<div class="transaction-form">
  <!-- Título -->
  <div class="form-group">
    <label class="form-label">Título</label>
    <input 
      type="text" 
      class="form-input" 
      placeholder="Ej: Viaje a Brasil" 
      [(ngModel)]="titulo" 
    />
  </div>

  <!-- Monto Objetivo -->
  <div class="form-group amount-group">
    <label class="form-label">Monto Objetivo</label>
    <input 
      type="number" 
      class="form-input" 
      placeholder="0" 
      [(ngModel)]="montoObjetivo"
      min="0"
      step="0.01"
    />
  </div>

  <!-- Monto Actual (solo en edición) -->
  <div class="form-group" *ngIf="edit">
    <label class="form-label">Monto Actual</label>
    <input 
      type="number" 
      class="form-input" 
      placeholder="0" 
      [(ngModel)]="montoActual" 
      readonly 
      style="background: rgba(255, 255, 255, 0.05); cursor: not-allowed;"
    />
  </div>

  <!-- Categoría -->
  <div class="form-group">
    <label class="form-label">Categoría (opcional)</label>
    <mat-select
      class="detail-select"
      [(ngModel)]="categoriaId"
      placeholder="Sin categoría"
    >
      <mat-option value="">Sin categoría</mat-option>
      <mat-option *ngFor="let categoria of categorias" [value]="categoria.id">
        {{ categoria.nombre }}
      </mat-option>
    </mat-select>
  </div>

  <!-- Fechas -->
  <div class="form-row">
    <div class="form-group">
      <label class="form-label">Fecha Inicio</label>
      <div class="input-with-icon">
        <input 
          type="date" 
          class="form-input" 
          [(ngModel)]="fechaInicio" 
        />
        <i class="mdi mdi-calendar"></i>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Fecha Esperada</label>
      <div class="input-with-icon">
        <input 
          type="date" 
          class="form-input" 
          [(ngModel)]="fechaEsperadaFinalizacion" 
        />
        <i class="mdi mdi-calendar"></i>
      </div>
    </div>
  </div>

  <!-- Fecha de finalización (solo si está completado) -->
  <div class="form-group" *ngIf="isCompleted()">
    <label class="form-label">Fecha de Finalización</label>
    <div class="input-with-icon">
      <input 
        type="date" 
        class="form-input" 
        [(ngModel)]="fechaFin" 
      />
      <i class="mdi mdi-calendar"></i>
    </div>
  </div>

  <!-- Estado del objetivo (solo en edición) -->
  <div class="form-group status-field" *ngIf="edit">
    <div class="status-header">
      <label class="form-label">Estado del objetivo</label>
      <span class="status-text" [class.completed]="isCompleted()">
        {{ isCompleted() ? '✓ Completado' : 'Pendiente' }}
      </span>
    </div>
    <label class="switch">
      <input 
        type="checkbox" 
        [checked]="isCompleted()" 
        (change)="toggleEstado()"
      />
      <span class="slider"></span>
    </label>
  </div>

  <!-- Sección de progreso (solo en edición) -->
  <div class="progress-section" *ngIf="edit">
    <div class="progress-header">
      <span class="progress-label">PROGRESO</span>
      <span class="progress-percentage">{{ getProgress().toFixed(0) }}%</span>
    </div>
    <div class="progress-bar-container">
      <div 
        class="progress-bar" 
        [style.width.%]="getProgress()"
        [style.background-color]="color"
      ></div>
    </div>
    <div class="progress-info">
      <span class="progress-current">${{ montoActual.toFixed(2) }}</span>
      <span class="progress-separator">de</span>
      <span class="progress-target">${{ (montoObjetivo || 0).toFixed(2) }}</span>
    </div>
  </div>

      <!-- Sección de operaciones (solo en edición) -->
      <div class="operaciones-section" *ngIf="edit">
        <div class="operaciones-header">
          <div class="header-left">
            <i class="mdi mdi-cash-multiple"></i>
            <span class="operaciones-label">Operaciones del objetivo</span>
            <span class="operaciones-count">{{ operaciones.length }}</span>
          </div>
          <button type="button" class="add-operacion-btn" (click)="addOperacion()" aria-label="Agregar operación">
            <i class="mdi mdi-plus"></i>
            <span>Agregar</span>
          </button>
        </div>

        <div class="operaciones-list" *ngIf="operaciones.length > 0">
          <div 
            class="operacion-item" 
            *ngFor="let operacion of operaciones; let i = index"
            [class.editing]="editingIndex === i"
            (click)="startEditOperacion(i)"
          >
            <div 
              class="operacion-icon" 
              [class.ingreso]="isIngreso(operacion)"
              [class.egreso]="!isIngreso(operacion)"
            >
              <i class="mdi" [ngClass]="isIngreso(operacion) ? 'mdi-arrow-down' : 'mdi-arrow-up'"></i>
            </div>
            
            <div class="operacion-content" *ngIf="editingIndex !== i">
              <div class="operacion-info">
                <span class="operacion-desc">{{ operacion.descripcion || 'Sin descripción' }}</span>
                <span class="operacion-date">{{ formatDate(operacion.fecha) }}</span>
              </div>
              <span class="operacion-amount" [class.ingreso]="isIngreso(operacion)" [class.egreso]="!isIngreso(operacion)">
                {{ isIngreso(operacion) ? '+' : '-' }}${{ operacion.monto.toFixed(2) }}
              </span>
            </div>

            <div class="operacion-edit-form" *ngIf="editingIndex === i" (click)="$event.stopPropagation()">
              <div class="edit-row tipo-toggle-row">
                <div class="tipo-toggle" (click)="toggleTipo(operacion)">
                  <div class="toggle-option" [class.active]="operacion.tipo === 'Ingreso'">
                    <i class="mdi mdi-arrow-down"></i>
                    Ingreso
                  </div>
                  <div class="toggle-option" [class.active]="operacion.tipo === 'Egreso'">
                    <i class="mdi mdi-arrow-up"></i>
                    Egreso
                  </div>
                </div>
              </div>
              <div class="edit-row">
                <input 
                  type="text" 
                  class="edit-desc-input" 
                  [(ngModel)]="operacion.descripcion"
                  placeholder="Descripción"
                />
              </div>
              <div class="edit-row">
                <input 
                  type="date" 
                  class="edit-date-input" 
                  [(ngModel)]="operacion.fecha"
                />
                <div class="edit-monto">
                  <span class="monto-prefix">$</span>
                  <input 
                    type="number" 
                    class="edit-monto-input" 
                    [(ngModel)]="operacion.monto"
                    placeholder="0.00"
                    min="0"
                    step="0.01"
                  />
                </div>
              </div>
              <div class="edit-actions">
                <button type="button" class="edit-save-btn" (click)="saveOperacion(); $event.stopPropagation()">
                  <i class="mdi mdi-check"></i>
                </button>
                <button type="button" class="edit-delete-btn" (click)="deleteOperacion(i); $event.stopPropagation()">
                  <i class="mdi mdi-delete"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="operaciones-empty" *ngIf="operaciones.length === 0">
          <i class="mdi mdi-cash-plus"></i>
          <p>No hay operaciones registradas</p>
          <span>Haz clic en "Agregar" para registrar operaciones</span>
        </div>
      </div>

  <!-- Botón de eliminar (solo en edición) -->
  <button 
    *ngIf="edit" 
    type="button" 
    class="delete-btn-bottom" 
    (click)="onDelete()">
    <i class="mdi mdi-delete"></i>
    Eliminar Objetivo
  </button>
</div>
</div>
